(()=>{"use strict";var t={913:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.config=void 0;const o=r(142),a=r(282);o.config(),e.config={auth:{token:a.env.AUTH_TOKEN||""},db:{path:a.env.DB_PATH||":memory:"},http:{port:+(a.env.HTTP_PORT||3e3)}},e.default=e.config},244:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BoardController=void 0;const o=r(758);class a{constructor(t,e){this.boardRepository=t,this.boardManager=e,this.index=async t=>{const e=+(t.query.page||0),r=await this.boardRepository.browse(e);t.body={items:r.map(this.convertModelToDto)}},this.show=async t=>{const e=String(t.params.slug||"").trim(),r=await this.boardRepository.readBySlug(e);if(null===r)throw new o.NotFoundError("slug");t.body={item:this.convertModelToDto(r)}},this.create=async t=>{const e=String(t.request.body.slug||"").trim(),r=String(t.request.body.title||"").trim(),a=await this.boardManager.createBoard(this.boardRepository,e,r);if(null===a)throw new o.NotFoundError("slug");t.status=201,t.set("Location",`/api/v1/boards/${a.slug}`),t.body={item:this.convertModelToDto(a)}},this.update=async t=>{const e=String(t.params.slug||"").trim(),r=String(t.request.body.slug||"").trim(),a=String(t.request.body.title||"").trim(),s=await this.boardManager.updateBoard(this.boardRepository,e,r,a);if(null===s)throw new o.NotFoundError("slug");t.body={item:this.convertModelToDto(s)}},this.delete=async t=>{const e=String(t.params.slug||"").trim(),r=await this.boardManager.deleteBoard(this.boardRepository,e);if(null===r)throw new o.NotFoundError("slug");t.body={item:this.convertModelToDto(r)}}}convertModelToDto(t){return{slug:t.slug,title:t.title,created_at:t.createdAt.toISOString(),post_count:+t.postCount}}}e.BoardController=a,e.default=a},762:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BoardThreadController=void 0;const o=r(758);class a{constructor(t,e){this.boardRepository=t,this.threadRepository=e,this.index=async t=>{const e=String(t.params.slug||"").trim(),r=await this.boardRepository.readBySlug(e);if(null===r)throw new o.NotFoundError("slug");const a=+(t.query.page||0),s=await this.threadRepository.browseForBoard(r.id,a);t.body={items:s.map(this.convertModelToDto)}},this.show=async t=>{const e=String(t.params.slug||"").trim(),r=await this.boardRepository.readBySlug(e);if(null===r)throw new o.NotFoundError("slug");const a=+(t.params.threadId||0),s=await this.threadRepository.read(a);if(null===s||s.board.id!==r.id)throw new o.NotFoundError("threadId");t.body={item:this.convertModelToDto(s)}},this.create=async t=>{const e=String(t.params.slug||"").trim(),r=await this.boardRepository.readBySlug(e);if(null===r)throw new o.NotFoundError("slug");const a=String(t.request.body.name||""),s=String(t.request.body.message||""),i=t.request.ip,d=await r.createThread(this.boardRepository,this.threadRepository,a,s,i);t.status=201,t.set("Location",`/api/v1/boards/${r.slug}/threads/${d.id}`),t.body={item:this.convertModelToDto(d)}},this.delete=async t=>{const e=String(t.params.slug||"").trim(),r=await this.boardRepository.readBySlug(e);if(null===r)throw new o.NotFoundError("slug");const a=+(t.params.threadId||0),s=await r.deleteThread(this.threadRepository,a);t.body={item:this.convertModelToDto(s)}}}convertModelToDto(t){return{id:+t.id,slug:t.board.slug,name:t.name,message:t.message,ip:t.ip,created_at:t.createdAt.toISOString(),bumped_at:t.bumpedAt.toISOString()}}}e.BoardThreadController=a,e.default=a},356:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BoardThreadPostController=void 0;const o=r(758);class a{constructor(t,e,r){this.boardRepository=t,this.threadRepository=e,this.postRepository=r,this.index=async t=>{const e=String(t.params.slug||"").trim(),r=await this.boardRepository.readBySlug(e);if(null===r)throw new o.NotFoundError("slug");const a=+(t.params.threadId||0),s=await this.threadRepository.read(a);if(null===s||s.board.id!==r.id)throw new o.NotFoundError("threadId");const i=await this.postRepository.browseForThread(a);t.body={items:i.map(this.convertModelToDto)}},this.show=async t=>{const e=String(t.params.slug||"").trim(),r=await this.boardRepository.readBySlug(e);if(null===r)throw new o.NotFoundError("slug");const a=+(t.params.threadId||0),s=await this.threadRepository.read(a);if(null===s||s.board.id!==r.id)throw new o.NotFoundError("threadId");const i=+(t.params.id||0),d=await this.postRepository.read(i);if(null===d||d.parentId!==s.id&&d.id!==s.id||d.board.id!==r.id)throw new o.NotFoundError("id");t.body={item:this.convertModelToDto(d)}},this.create=async t=>{const e=String(t.params.slug||"").trim(),r=await this.boardRepository.readBySlug(e);if(null===r)throw new o.NotFoundError("slug");const a=+(t.params.threadId||0),s=await this.threadRepository.read(a);if(null===s||s.board.id!==r.id)throw new o.NotFoundError("threadId");const i=String(t.request.body.name||""),d=String(t.request.body.message||""),n=t.request.ip,l=await s.createPost(this.boardRepository,this.postRepository,i,d,n);t.status=201,t.set("Location",`/api/v1/boards/${r.slug}/threads/${s.id}/posts/${l.id}`),t.body={item:this.convertModelToDto(l)}},this.delete=async t=>{const e=String(t.params.slug||"").trim(),r=await this.boardRepository.readBySlug(e);if(null===r)throw new o.NotFoundError("slug");const a=+(t.params.threadId||0),s=await this.threadRepository.read(a);if(null===s||s.board.id!==r.id)throw new o.NotFoundError("threadId");const i=+(t.params.id||0),d=await s.deletePost(this.postRepository,i);t.body={item:this.convertModelToDto(d)}}}convertModelToDto(t){return{id:+t.id,slug:t.board.slug,parent_id:+t.parentId,name:t.name,message:t.message,ip:t.ip,created_at:t.createdAt.toISOString()}}}e.BoardThreadPostController=a,e.default=a},364:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PostController=void 0;const o=r(758);class a{constructor(t,e,r){this.boardRepository=t,this.threadRepository=e,this.postRepository=r,this.index=async t=>{const e=await this.postRepository.browse();t.body={items:e.map(this.convertModelToDto)}},this.show=async t=>{const e=+(t.params.id||0),r=await this.postRepository.read(e);if(null===r)throw new o.NotFoundError("id");t.body={item:this.convertModelToDto(r)}},this.create=async t=>{const e=+(t.request.body.parentId||0),r=await this.threadRepository.read(e);if(null===r)throw new o.NotFoundError("parentId");const a=String(t.request.body.name||""),s=String(t.request.body.message||""),i=t.request.ip,d=await r.createPost(this.boardRepository,this.postRepository,a,s,i);t.status=201,t.set("Location",`/api/v1/posts/${d.id}`),t.body={item:this.convertModelToDto(d)}},this.delete=async t=>{const e=+(t.params.id||0);let r=await this.postRepository.read(e);if(null===r)throw new o.NotFoundError("id");const a=await this.threadRepository.read(r.parentId);if(null===a)throw new o.NotFoundError("threadId");r=await a.deletePost(this.postRepository,e),t.body={item:this.convertModelToDto(r)}}}convertModelToDto(t){return{id:+t.id,slug:t.board.slug,parent_id:+t.parentId,name:t.name,message:t.message,ip:t.ip,created_at:t.createdAt.toISOString()}}}e.PostController=a,e.default=a},250:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ThreadController=void 0;const o=r(758);class a{constructor(t,e){this.boardRepository=t,this.threadRepository=e,this.index=async t=>{const e=+(t.query.page||0),r=await this.threadRepository.browse(e);t.body={items:r.map(this.convertModelToDto)}},this.show=async t=>{const e=+(t.params.threadId||0),r=await this.threadRepository.read(e);if(null===r)throw new o.NotFoundError("threadId");t.body={item:this.convertModelToDto(r)}},this.create=async t=>{const e=String(t.request.body.slug||"").trim(),r=await this.boardRepository.readBySlug(e);if(null===r)throw new o.NotFoundError("slug");const a=String(t.request.body.name||""),s=String(t.request.body.message||""),i=t.request.ip,d=await r.createThread(this.boardRepository,this.threadRepository,a,s,i);t.status=201,t.set("Location",`/api/v1/threads/${d.id}`),t.body={item:this.convertModelToDto(d)}},this.delete=async t=>{const e=+(t.params.threadId||0);let r=await this.threadRepository.read(e);if(null===r)throw new o.NotFoundError("threadId");const a=await this.boardRepository.read(r.board.id);if(null===a)throw new o.NotFoundError("slug");r=await a.deleteThread(this.threadRepository,e),t.body={item:this.convertModelToDto(r)}}}convertModelToDto(t){return{id:+t.id,slug:t.board.slug,name:t.name,message:t.message,ip:t.ip,created_at:t.createdAt.toISOString(),bumped_at:t.bumpedAt.toISOString()}}}e.ThreadController=a,e.default=a},417:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ThreadPostController=void 0;const o=r(758);class a{constructor(t,e,r){this.boardRepository=t,this.threadRepository=e,this.postRepository=r,this.index=async t=>{const e=+(t.params.threadId||0);if(null===await this.threadRepository.read(e))throw new o.NotFoundError("threadId");const r=await this.postRepository.browseForThread(e);t.body={items:r.map(this.convertModelToDto)}},this.show=async t=>{const e=+(t.params.threadId||0),r=await this.threadRepository.read(e);if(null===r)throw new o.NotFoundError("threadId");const a=+(t.params.id||0),s=await this.postRepository.read(a);if(null===s||s.parentId!==r.id&&s.id!==r.id)throw new o.NotFoundError("id");t.body={item:this.convertModelToDto(s)}},this.create=async t=>{const e=+(t.params.threadId||0),r=await this.threadRepository.read(e);if(null===r)throw new o.NotFoundError("threadId");const a=String(t.request.body.name||""),s=String(t.request.body.message||""),i=t.request.ip,d=await r.createPost(this.boardRepository,this.postRepository,a,s,i);t.status=201,t.set("Location",`/api/v1/threads/${r.id}/posts/${d.id}`),t.body={item:this.convertModelToDto(d)}},this.delete=async t=>{const e=+(t.params.threadId||0),r=await this.threadRepository.read(e);if(null===r)throw new o.NotFoundError("threadId");const a=+(t.params.id||0),s=await r.deletePost(this.postRepository,a);t.body={item:this.convertModelToDto(s)}}}convertModelToDto(t){return{id:+t.id,slug:t.board.slug,parent_id:+t.parentId,name:t.name,message:t.message,ip:t.ip,created_at:t.createdAt.toISOString()}}}e.ThreadPostController=a,e.default=a},758:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ConflictError=e.NotFoundError=e.NotAuthenticatedError=e.ValidationError=void 0;class r extends Error{constructor(t,e,r){super(r),this.field=t,this.error=e}}e.ValidationError=r;class o extends Error{}e.NotAuthenticatedError=o;class a extends Error{constructor(t,e){super(e),this.field=t}}e.NotFoundError=a;class s extends Error{constructor(t,e){super(e),this.field=t}}e.ConflictError=s},343:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.auth=void 0;const o=r(913),a=r(758);e.auth=function(){return async function(t,e){if(t.get("Authorization")!==`Bearer ${o.default.auth.token}`)throw new a.NotAuthenticatedError;await e()}}},697:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.errorHandler=void 0;const o=r(758);e.errorHandler=function(){return async function(t,e){try{await e()}catch(e){e instanceof o.ValidationError?(t.status=400,t.body={status:400,field:e.field,message:e.error}):e instanceof o.NotAuthenticatedError?(t.status=401,t.set("WWW-Authenticate","Bearer"),t.body={status:401,message:"not_authenticated"}):e instanceof o.NotFoundError?(t.status=404,t.body={status:404,field:e.field,message:e.message||"not_found"}):e instanceof o.ConflictError?(t.status=409,t.body={status:409,field:e.field,message:e.message||"conflict"}):(t.status=500,t.body={status:500,message:"internal_server_error"},console.error(e))}}}},482:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BoardManager=void 0;const o=r(758),a=r(812);class s{async createBoard(t,e,r){if(!e.length)throw new o.ValidationError("slug","required");if(e.length>a.default.MAX_SLUG_LENGTH)throw new o.ValidationError("slug","max-length");if(null===e.match(a.default.SLUG_PATTERN))throw new o.ValidationError("slug","pattern");if(!r.length)throw new o.ValidationError("title","required");if(e.length>a.default.MAX_TITLE_LENGTH)throw new o.ValidationError("title","max-length");if(-1!==a.default.RESERVED_NAMES.indexOf(e))throw new o.ConflictError("slug");if(null!==await t.readBySlug(e))throw new o.ConflictError("slug");const s=await t.add(e,r);if(null===s)throw new o.NotFoundError("slug");return s}async updateBoard(t,e,r,s){if(!r.length)throw new o.ValidationError("slug","required");if(r.length>a.default.MAX_SLUG_LENGTH)throw new o.ValidationError("slug","max-length");if(null===r.match(a.default.SLUG_PATTERN))throw new o.ValidationError("slug","pattern");if(!s.length)throw new o.ValidationError("title","required");if(r.length>a.default.MAX_TITLE_LENGTH)throw new o.ValidationError("title","max-length");if(-1!==a.default.RESERVED_NAMES.indexOf(r))throw new o.ConflictError("slug");let i=await t.readBySlug(e);if(null===i)throw new o.NotFoundError("slug");if(i=await t.edit(i.id,r,s),null===i)throw new o.NotFoundError("slug");return i}async deleteBoard(t,e){let r=await t.readBySlug(e);if(null===r)throw new o.NotFoundError("slug");if(r=await t.delete(r.id),null===r)throw new o.NotFoundError("slug");return r}}e.BoardManager=s,e.default=s},812:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Board=void 0;const o=r(758),a=r(624);class s{constructor(t,e,r,o,a){this.id=t,this.slug=e,this.title=r,this.createdAt=o,this.postCount=a}async createThread(t,e,r,s,i){if(!r.length)throw new o.ValidationError("name","required");if(r.length>a.default.MAX_NAME_LENGTH)throw new o.ValidationError("name","max-length");if(!s.length)throw new o.ValidationError("message","required");if(s.length>a.default.MAX_MESSAGE_LENGTH)throw new o.ValidationError("message","max-length");let d=null;try{await e.begin(),d=await e.add(this.id,r,s,i),await t.incrementPostCount(this.id),await e.commit()}catch(t){throw await e.rollback(),t}if(null===d)throw new o.NotFoundError("id");return d}async deleteThread(t,e){let r=await t.read(e);if(null===r||r.board.id!==this.id)throw new o.NotFoundError("threadId");if(r=await t.delete(e),null===r)throw new o.NotFoundError("threadId");return r}}e.Board=s,s.MAX_SLUG_LENGTH=20,s.MAX_TITLE_LENGTH=100,s.SLUG_PATTERN=/^[0-9a-z_-]+$/,s.RESERVED_NAMES=["admin","api","dashboard","settings","sse","ws"],e.default=s},894:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Post=void 0;class r{constructor(t,e,r,o,a,s,i){this.id=t,this.board=e,this.parentId=r,this.name=o,this.message=a,this.ip=s,this.createdAt=i}}e.Post=r,r.MAX_NAME_LENGTH=40,r.MAX_MESSAGE_LENGTH=8e3,e.default=r},624:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Thread=void 0;const o=r(758);class a{constructor(t,e,r,o,a,s,i){this.id=t,this.board=e,this.name=r,this.message=o,this.ip=a,this.createdAt=s,this.bumpedAt=i}async createPost(t,e,r,s,i){if(!r.length)throw new o.ValidationError("name","required");if(r.length>a.MAX_NAME_LENGTH)throw new o.ValidationError("name","max-length");if(!s.length)throw new o.ValidationError("message","required");if(s.length>a.MAX_MESSAGE_LENGTH)throw new o.ValidationError("message","max-length");let d=null;try{await e.begin(),d=await e.add(this.board.id,this.id,r,s,i),await t.incrementPostCount(this.id),await e.commit()}catch(t){throw await e.rollback(),t}if(null===d)throw new o.NotFoundError("id");return d}async deletePost(t,e){let r=await t.read(e);if(null===r||r.parentId!==this.id)throw new o.NotFoundError("id");if(r=await t.delete(e),null===r)throw new o.NotFoundError("id");return r}}e.Thread=a,a.MAX_NAME_LENGTH=40,a.MAX_MESSAGE_LENGTH=8e3,e.default=a},59:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BoardRepository=void 0;const o=r(812),a=r(251);class s extends a.default{async browse(t=0){const e=`SELECT * FROM boards\n      ORDER BY post_count DESC, id DESC\n      LIMIT ${s.PER_PAGE} OFFSET ${Math.max(0,Math.floor(t))*s.PER_PAGE}`,{rows:r}=await this.allAsync(e);return r.map(this.convertDtoToModel)}async read(t){const{row:e}=await this.getAsync("SELECT * FROM boards\n      WHERE id = ?\n      ORDER BY id DESC\n      LIMIT 1",[t]);return null===e?null:this.convertDtoToModel(e)}async readBySlug(t){const{row:e}=await this.getAsync("SELECT * FROM boards\n      WHERE slug = ?\n      ORDER BY id DESC\n      LIMIT 1",[t]);return null===e?null:this.convertDtoToModel(e)}async edit(t,e,r){return null===await this.read(t)?null:(await this.runAsync("UPDATE boards\n      SET slug = ?, title = ?\n      WHERE id = ?",[e,r,t]),this.readBySlug(e))}async incrementPostCount(t){const e=await this.read(t);return null===e?null:(await this.runAsync("UPDATE boards\n      SET post_count = post_count + 1\n      WHERE id = ?",[t]),e)}async add(t,e){return await this.runAsync("INSERT INTO boards(slug, title, post_count, created_at)\n      VALUES (?, ?, 0, strftime('%s','now'))",[t,e]),this.readBySlug(t)}async delete(t){const e=await this.read(t);return null===e?null:(await this.runAsync("DELETE FROM boards\n      WHERE id = ?",[t]),e)}convertDtoToModel(t){return new o.default(+t.id,t.slug,t.title,new Date(t.created_at*s.MS_IN_SECOND),+t.post_count)}}e.BoardRepository=s,s.PER_PAGE=100,s.MS_IN_SECOND=1e3,e.default=s},320:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.setupDatabase=void 0,e.setupDatabase=function(t){t.serialize((()=>{t.run("CREATE TABLE IF NOT EXISTS boards (\n      id INTEGER NOT NULL PRIMARY KEY,\n      slug TEXT NOT NULL UNIQUE,\n      title TEXT NOT NULL,\n      post_count INTEGER NOT NULL,\n      created_at INTEGER NOT NULL\n    )"),t.run("CREATE INDEX IF NOT EXISTS boards_post_count_idx ON boards (post_count)"),t.run("CREATE TABLE IF NOT EXISTS posts (\n      id INTEGER NOT NULL PRIMARY KEY,\n      board_id INTEGER NOT NULL REFERENCES boards (id) ON DELETE CASCADE,\n      parent_id INTEGER REFERENCES posts (id) ON DELETE CASCADE,\n      name TEXT NOT NULL,\n      message TEXT NOT NULL,\n      ip TEXT NOT NULL,\n      created_at INTEGER NOT NULL,\n      bumped_at INTEGER\n    )"),t.run("CREATE INDEX IF NOT EXISTS posts_board_id_idx ON posts (board_id)"),t.run("CREATE INDEX IF NOT EXISTS posts_parent_id_idx ON posts (parent_id)"),t.run("CREATE INDEX IF NOT EXISTS posts_bumped_at_idx ON posts (bumped_at)")}))}},451:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PostRepository=void 0;const o=r(812),a=r(894),s=r(251);class i extends s.default{async browse(){const{rows:t}=await this.allAsync("SELECT\n        p.*,\n        b.id as board_id, b.slug as board_slug, b.title as board_title, b.created_at as board_created_at, b.post_count as board_post_count\n      FROM posts p\n      INNER JOIN boards b ON b.id = p.board_id\n      ORDER BY p.id");return t.map(this.convertDtoToModel)}async browseForThread(t){const{rows:e}=await this.allAsync("SELECT\n        p.*,\n        b.id as board_id, b.slug as board_slug, b.title as board_title, b.created_at as board_created_at, b.post_count as board_post_count\n      FROM posts p\n      INNER JOIN boards b ON b.id = p.board_id\n      WHERE p.parent_id = ? OR p.id = ?\n      ORDER BY p.id",[t,t]);return e.map(this.convertDtoToModel)}async read(t){const{row:e}=await this.getAsync("SELECT\n        p.*,\n        b.id as board_id, b.slug as board_slug, b.title as board_title, b.created_at as board_created_at, b.post_count as board_post_count\n      FROM posts p\n      INNER JOIN boards b ON b.id = p.board_id\n      WHERE p.id = ?\n      ORDER BY p.id DESC\n      LIMIT 1",[t]);return null===e?null:this.convertDtoToModel(e)}async add(t,e,r,o,a){const s=await this.runAsync("INSERT INTO posts(board_id, parent_id, name, message, ip, created_at, bumped_at)\n      VALUES (?, ?, ?, ?, ?, strftime('%s','now'), NULL)",[t,e,r,o,a]);return this.read(s.lastID)}async delete(t){const e=await this.read(t);return null===e?null:(await this.runAsync("DELETE FROM posts\n      WHERE id = ? AND parent_id IS NOT NULL",[t]),e)}convertDtoToModel(t){return new a.default(+t.id,new o.default(+t.board_id,t.board_slug,t.board_title,new Date(+t.board_created_at*i.MS_IN_SECOND),+t.board_post_count),+(t.parent_id||0),t.name,t.message,t.ip,new Date(t.created_at*i.MS_IN_SECOND))}}e.PostRepository=i,i.PER_PAGE=100,i.MS_IN_SECOND=1e3,e.default=i},251:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Repository=void 0;class r{constructor(t){this.db=t}async begin(){await this.runAsync("BEGIN")}async commit(){await this.runAsync("COMMIT")}async rollback(){await this.runAsync("ROLLBACK")}async runAsync(t,e=[]){return new Promise(((r,o)=>{this.db.run(t,e,(function(t){if(null!==t)return o(t);r(this)}))}))}async getAsync(t,e=[]){return new Promise(((r,o)=>{this.db.get(t,e,(function(t,e){return null!==t?o(t):void 0===e?r({statement:this,row:null}):void r({statement:this,row:e})}))}))}async allAsync(t,e=[]){return new Promise(((r,o)=>{this.db.all(t,e,(function(t,e){if(null!==t)return o(t);r({statement:this,rows:e})}))}))}}e.Repository=r,e.default=r},801:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ThreadRepository=void 0;const o=r(812),a=r(624),s=r(251);class i extends s.default{async browse(t=0){const e=`SELECT\n        p.*,\n        b.id as board_id, b.slug as board_slug, b.title as board_title, b.created_at as board_created_at, b.post_count as board_post_count\n      FROM posts p\n      INNER JOIN boards b ON b.id = p.board_id\n      WHERE p.parent_id IS NULL\n      ORDER BY p.bumped_at DESC, p.id DESC\n      LIMIT ${i.PER_PAGE} OFFSET ${Math.max(0,Math.floor(t))*i.PER_PAGE}`,{rows:r}=await this.allAsync(e);return r.map(this.convertDtoToModel)}async browseForBoard(t,e=0){const r=`SELECT\n        p.*,\n        b.id as board_id, b.slug as board_slug, b.title as board_title, b.created_at as board_created_at, b.post_count as board_post_count\n      FROM posts p\n      INNER JOIN boards b ON b.id = p.board_id\n      WHERE p.board_id = ? AND p.parent_id IS NULL\n      ORDER BY p.bumped_at DESC, p.id DESC\n      LIMIT ${i.PER_PAGE} OFFSET ${Math.max(0,Math.floor(e))*i.PER_PAGE}`,{rows:o}=await this.allAsync(r,[t]);return o.map(this.convertDtoToModel)}async read(t){const{row:e}=await this.getAsync("SELECT\n        p.*,\n        b.id as board_id, b.slug as board_slug, b.title as board_title, b.created_at as board_created_at, b.post_count as board_post_count\n      FROM posts p\n      INNER JOIN boards b ON b.id = p.board_id\n      WHERE p.id = ? AND p.parent_id IS NULL\n      ORDER BY p.id DESC\n      LIMIT 1",[t]);return null===e?null:this.convertDtoToModel(e)}async add(t,e,r,o){const a=await this.runAsync("INSERT INTO posts(board_id, parent_id, name, message, ip, created_at, bumped_at)\n      VALUES (?, NULL, ?, ?, ?, strftime('%s','now'), strftime('%s','now'))",[t,e,r,o]);return this.read(a.lastID)}async delete(t){const e=await this.read(t);return null===e?null:(await this.runAsync("DELETE FROM posts\n      WHERE id = ? AND parent_id IS NULL",[t]),e)}convertDtoToModel(t){return new a.default(+t.id,new o.default(+t.board_id,t.board_slug,t.board_title,new Date(+t.board_created_at*i.MS_IN_SECOND),+t.board_post_count),t.name,t.message,t.ip,new Date(t.created_at*i.MS_IN_SECOND),new Date(t.bumped_at*i.MS_IN_SECOND))}}e.ThreadRepository=i,i.PER_PAGE=10,i.MS_IN_SECOND=1e3,e.default=i},142:t=>{t.exports=require("dotenv")},406:t=>{t.exports=require("koa")},155:t=>{t.exports=require("koa-bodyparser")},752:t=>{t.exports=require("koa-router")},661:t=>{t.exports=require("sqlite3")},685:t=>{t.exports=require("http")},282:t=>{t.exports=require("process")}},e={};function r(o){var a=e[o];if(void 0!==a)return a.exports;var s=e[o]={exports:{}};return t[o](s,s.exports,r),s.exports}(()=>{const t=r(685),e=r(406),o=r(155),a=r(752),s=r(661),i=r(913),d=r(244),n=r(762),l=r(356),u=r(364),h=r(250),c=r(417),p=r(343),E=r(697),w=r(482),b=r(59),_=r(320),y=r(451),g=r(801),m=new s.Database(i.default.db.path,s.OPEN_CREATE|s.OPEN_READWRITE);(0,_.setupDatabase)(m);const N=new b.default(m),T=new g.default(m),f=new y.default(m),R=new w.default,S=new d.default(N,R),I=new n.default(N,T),M=new l.default(N,T,f),v=new h.default(N,T),O=new c.default(N,T,f),A=new u.default(N,T,f),D=new a;D.get("/api/v1/boards",S.index),D.post("/api/v1/boards",S.create),D.get("/api/v1/boards/:slug",S.show),D.put("/api/v1/boards/:slug",(0,p.auth)(),S.update),D.delete("/api/v1/boards/:slug",(0,p.auth)(),S.delete),D.get("/api/v1/boards/:slug/threads",I.index),D.post("/api/v1/boards/:slug/threads",I.create),D.get("/api/v1/boards/:slug/threads/:threadId",I.show),D.delete("/api/v1/boards/:slug/threads/:threadId",(0,p.auth)(),I.delete),D.get("/api/v1/boards/:slug/threads/:threadId/posts",M.index),D.post("/api/v1/boards/:slug/threads/:threadId/posts",M.create),D.get("/api/v1/boards/:slug/threads/:threadId/posts/:id",M.show),D.delete("/api/v1/boards/:slug/threads/:threadId/posts/:id",(0,p.auth)(),M.delete),D.get("/api/v1/threads",v.index),D.post("/api/v1/threads",v.create),D.get("/api/v1/threads/:threadId",v.show),D.delete("/api/v1/threads/:threadId",(0,p.auth)(),v.delete),D.get("/api/v1/threads/:threadId/posts",O.index),D.post("/api/v1/threads/:threadId/posts",O.create),D.get("/api/v1/threads/:threadId/posts/:id",O.show),D.delete("/api/v1/threads/:threadId/posts/:id",(0,p.auth)(),O.delete),D.get("/api/v1/posts",A.index),D.post("/api/v1/posts",A.create),D.get("/api/v1/posts/:id",A.show),D.delete("/api/v1/posts/:id",A.delete);const L=new e;L.use((0,E.errorHandler)()),L.use(o()),L.use(D.routes()),L.use(D.allowedMethods()),t.createServer(L.callback()).listen(i.default.http.port)})()})();